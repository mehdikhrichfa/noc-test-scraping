/**
 * @file
 * Contains jQuery-based javascript to be loaded on all theme pages
 *
 * See documentation on jQuery and Drupal at http://drupal.org/node/171213
 */

(function ($) {

  Drupal.behaviors.stanford = {
    attach: function(context, settings) {

      //external links
      $("a.external").attr("target","_blank");

      //enable labels to act like prefilled form values
      $(".label-swap").prev("label").addClass("prefill");

      $("label.prefill").click( function() {
        //input = $( '#'+$(this).attr('for')+":first" );
        input = $(this).next("input[type=text]"); //still busted on get-involed page
        if(input.length && input.attr('type') in {'text': '', 'email': '', 'search': '', 'url': ''}) {
          $(this).fadeOut(100);
          input.focus();
        }
      });

      $("input.label-swap").focus( function() {
        $(this).prev("label").fadeOut(100);
      }).blur( function() {
        if ( $(this).val() == "") {
          $(this).prev('label').fadeIn(100);
        }
      }).each(function(){
        if ( $(this).val() != "") {
          $(this).prev('label').hide(); //hide labels if field is prefilled
        }
      });

      //homepage accordion
      if ($.fn.hrzAccordion && $(".accordion").length) {
        $(".accordion .rotator-items").hrzAccordion({
          eventTrigger: 'click',
          hashPrefix: 'feature',
          handleClass: 'handle',
          handlePosition: 'left',
          fixedWidth: 508,
          openOnLoad: 1
          //docs at http://www.portalzine.de/index?/Horizontal_Accordion_Docu
        });
      }

      //homepage Of Interest li's as links
      $("#block-views-of-interest-block .view-content li").click(function() {
        window.location = $(this).find('a').attr('href');
      });

      $(document).ready(function() {
        //map stuff
        if ( $(".gmap").length) {
          //kill click events on marker
          Drupal.settings.gmap.auto2map.markers[0].text = null;
          $(".gmap").insertBefore(".vcard");
        }
      });

      //move event fields
      $(".node-type-event .field-type-generated").appendTo(".group_meta");

      //autosubmit fix
      $(".ctools-auto-submit-full-form").find("select[id!='cis-monthly-dropdown-min']").change(function() {
        $(this).parents("form").submit();
      });

      //change and autosubmit for the blog post events
      $("#cis-monthly-dropdown-min").live('change', function(){
        v = $(this).val();
        if (v != '') {
          date = v.split('-');
          d = new Date(date[0], date[1], 0);
          m = d.getMonth() + 1;
          out = d.getFullYear() + '-' + m + '-' + d.getDate();
        } else {
          out = '';
        }
        $("#edit-created-max").val(out);
        $(this).parents("form").submit();
      });

      //get involved links
      $(".frontpage--get-involved-content .frontpage-block").each(function() {
        if ( $(".links a", this).length == 1 ) {
          url = $(".links a", this).attr('href');
          myclass = $(".links a", this).attr('class');
          $("h3", this).wrap('<a href="'+url+'" class="'+myclass+'"/>');
        }
      });

      //quicktabs auto-select if none are selected
      if ($(".quicktabs-tabs li").length && !$(".quicktabs-tabs li.active").length) {
        $(".quicktabs-tabs li:first-child").click();
      }

      //filter out the map regions based on controller
      if ( $('map').length && $('.map-control').length) {
				$('area').each( function() {
					var this_country = $(this).attr('alt'),
						this_country_link = $('.map-control a[class="'+this_country+'"]');
					if ( !this_country_link.length ) $(this).remove();
					$(this).attr('href', this_country_link.attr('href'));
				});
      }

      //activate the map hilighting
      $('img[usemap]').maphilight({
        fillColor: 'c72513',
        fillOpacity: 1,
        stroke: false,
        fade: true,
        strokeColor: 'df1f00',
        strokeOpacity: 0.8,
        groupBy: 'alt'
      });

    }
  };
})(jQuery);