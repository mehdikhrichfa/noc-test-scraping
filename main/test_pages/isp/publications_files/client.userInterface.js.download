define(function (require) {

	"use strict";

	var $ = require("jquery");
	require("jquery");
	require("jqueryUI");
	require("bootstrap");
	require("bsAccessible");
	require("selectBoxIt");
	require("placeholder");
	require("shadowBox");
	require("tabCollapse");
	require("carousel");
	require("tabs");
    require("textResizeDetector");

	(function() {

		var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

		// jQuery SelectBoxIt - http://gregfranko.com/jquery.selectBoxIt.js/
		//function initSelectBoxIt(){
		//	if($('select').length > 0) {
         //       // selectboxit is another jquery plugin that doesn't fully support AMD.
         //       // it needs to reference window.jQuery.
		//		window.jQuery("select").selectBoxIt({
		//			aggressiveChange: true,
		//			theme: 'default',
		//			autoWidth: false
		//		});
		//	}
		//}

		// jQuery placeholder - https://github.com/mathiasbynens/jquery-placeholder
		function initPlaceholder(){
			if($('body').is('.ie9, .lt-ie9')) {
				$('input, textarea').placeholder();
			}
		}

		// setupUITabs http://api.jqueryui.com/tabs/
		function initUITabs() {
			var $tabNav = $('.tab-container');
			if ($tabNav.length > 0) {
				$tabNav.tabs({
					create: function(){
						$(this).removeClass('no-js');
					}
				});
			}
		}

		// setupUIAccordion http://api.jqueryui.com/accordion/
		function initUIAccordion() {
			var $accordion = $('.accordion-container');
			if ($accordion.length > 0) {
				$accordion.each(function(){
					$(this).accordion({
						collapsible: true,
						animate: 'easeInOutExpo',
						icons: {
							"header": "icon-accordion-open",
							"activeHeader": "icon-accordion-close"
						},
						heightStyle: "content",
						create: function(){
							$(this).removeClass('no-js');
							//add hash targeting
							if(location.hash){
								var hash = window.location.hash;
								var targetHash = hash.substring(hash.lastIndexOf('#'), hash.length);
								var targetItem = $('a[href*='+ targetHash + ']');
								var offset = $(targetItem).offset().top;

								$accordion.find(targetItem).closest('h2').trigger('click');
								$('html, body').animate({scrollTop:offset}, 500);
							}
						}
					});
				});
			}
		}

		//setupSmoothScroll
		function initSmoothScroll() {
			var anchorLink = $('.anchor-link');
			if (anchorLink.length > 0) {
				anchorLink.on('click', function(event){
					event.preventDefault();
                    //var href = $(this).attr('href');
                    //var target = $(href);
                    //
                    //if (target.length === 0) {
                    //    target = $('a[name="'+ href.substring(1) +'"]');
                    //}
                    //
                    //// check for special case - we have an anchor as the first line of a module, and really want to go to the module header...
                    //var section = target.closest('section');
                    //
                    //if (section.length > 0) {
                    //    target = section;
                    //}
                    //
                    //var offset = target.offset();
					//var offset = $($(this).attr('href')).closest("section").offset();
					var offset = $($(this).attr('href')).offset();
                    if (offset && offset.top) {
                        $('html, body').animate({scrollTop:offset.top - $('.header-container').outerHeight() - 20}, 500);
                    }
				});
			}
		}
		//Shadowbox - http://www.shadowbox-js.com/
		function initShadowbox() {
			var $target = $('a[rel*="shadowbox"]');
			if ($target.length > 0) {
				window.Shadowbox.init();
			}
		}



		function initAreasInterest() {
			var $interest = $('.interest-callout');
			if ($(".areas-interest h2").css('font-size') === '28px') {
				$interest.each (function(){

							$(this).hover( function() {
									$(this).addClass('hovering');
							},
								function(){
									$(this).removeClass('hovering');
								});
					$('.interest-callout .upper-content a').on('focus', function(event) {
						$(this).parent().parent().parent().parent().addClass('hovering');
					});
					$('.interest-callout .upper-content a').on('blur', function(event) {
						$(this).parent().parent().parent().parent().removeClass('hovering');
					});

					$('.interest-callout .hover-content a').on('focus', function(event) {
						$(this).parent().parent().parent().addClass('hovering');
					});
					$('.interest-callout .hover-content a').on('blur', function(event) {
						$(this).parent().parent().parent().removeClass('hovering');
					});

				});
				}

			$(window).resize(function(){
				if ($(".areas-interest h2").css('font-size') === '20px')  {
					$interest.unbind();
				}
				if ($(".areas-interest h2").css('font-size') === '28px')  {
					$interest.each (function(){

						$(this).hover( function() {
								$(this).addClass('hovering');
							},
							function(){
								$(this).removeClass('hovering');
							});
					});
				}
			});


			var $trigger = $('.areas-interest .interest-menu');
			var $menu = $('.interest-mega-menu .collapsed-menu');
			if ($trigger.length > 0) {
				$trigger.on('click', function (e) {
					var $this = $(this);
					var target = $this.data('target');
					if($trigger.is('.animating')){
						event.stopPropagation();
					}
					else if ($this.hasClass('active')){
						$this.removeClass('active');
						$(target).slideUp(function() {
							$(target).removeClass('menu-open');
						});
					} else if ($menu.is('.menu-open:visible')) {
						var $menuOpen = $menu.closest('.menu-open');
						$trigger.removeClass('active');
						$this.addClass('animating');
						$menuOpen.slideUp({
							complete: function (){
								$menu.removeClass('menu-open');
								$(target).slideDown(function () {
									$(target).addClass('menu-open');
									$trigger.removeClass('animating');
								});
								$this.addClass('active');
							}
						});
					}
					else {
						$this.addClass('animating');
						$(target).slideDown(function() {
							$(target).addClass('menu-open');
							$trigger.removeClass('animating');
						});
						$this.addClass('active');
					}
					e.preventDefault();
				});
			}

		}

		function initWeatherAlert() {

            var id = $('.weather-alert').data('id');

            var cookieID = window.jQuery.cookie && window.jQuery.cookie('alert');

            if (!cookieID || id !== cookieID) {
                $(".weather-alert").show();

                $(".weather-alert .close-menu").click(function (e) {
                    if (window.jQuery.cookie) {
                        if (id) {
                            window.jQuery.cookie('alert', id, { expires: 356, path: '/' });
                        }
                    }
                    $(".weather-alert").hide();
                });
            }
		}
		//function initFilterMenu() {
		//	var $trigger = $('.filter-section .filter-menu');
		//	var $menu = $('.filter-mega-menu .collapsed-menu');
		//	if ($trigger.length > 0) {
		//		$trigger.on('click', function (e) {
		//			var $this = $(this);
		//			var target = $this.data('target');
		//			if($trigger.is('.animating')){
		//				event.stopPropagation();
		//			}
		//			else if ($this.hasClass('active')){
		//				$this.removeClass('active');
		//				$(target).slideUp(function() {
		//					$(target).removeClass('menu-open');
		//				});
		//			} else if ($menu.is('.menu-open:visible')) {
		//				var $menuOpen = $menu.closest('.menu-open');
		//				$trigger.removeClass('active');
		//				$this.addClass('animating');
		//				$menuOpen.slideUp({
		//					complete: function (){
		//						$menu.removeClass('menu-open');
		//						$(target).slideDown(function () {
		//							$(target).addClass('menu-open');
		//							$trigger.removeClass('animating');
		//						});
		//						$this.addClass('active');
		//					}
		//				});
		//			}
		//			else {
		//				$this.addClass('animating');
		//				$(target).slideDown(function() {
		//					$(target).addClass('menu-open');
		//					$trigger.removeClass('animating');
		//				});
		//				$this.addClass('active');
		//			}
		//			e.preventDefault();
		//		});
		//	}
		//}

		function initDesktopSearch() {
				var $searchInput = $("#global-search-mobile");

			   $(".search-link").click(function () {
				   $(this).addClass("search-close");
				   if($("#collapsible-search").css('display') === 'none') {
					   $("#collapsible-search").show();
					   $("#global-search-mobile").focus();
				   }
				   else {
					   $("#collapsible-search").hide();
					   $(this).removeClass("search-close");
				   }
			   });

			   // Setup click event
			   $("#search-btn").on('click', function () {
				   searchSite($searchInput.val());
			   });

			   $(document).on("keypress", '#global-search-mobile', function(e) {
					 if (e.which == 13) {
						 searchSite($searchInput.val());
					 }
				});

				// Redirect to search page.
				function searchSite(keyword){
					window.location = "/site-search?keyword=" + keyword;
				}

		}

		function initYLSMobileMenu() {
			   	$(".current-news-menu").click(function () {
				   if($(".current-news-mega-menu").css('display') === 'none') {
					   $(".current-news-mega-menu").show();
				   }
				   else {
					   $(".current-news-mega-menu").hide();
				   }
			   });

			   	$(".current-news-mega-menu a.tab1").click(function () {
					$(".current-news-mega-menu").hide();
				   	$("#section-linemove-1").show();
				   	$("#section-linemove-2").hide();
				   	$("#section-linemove-3").hide();
				   	$("#section-linemove-4").hide();
				   	$("#section-linemove-5").hide();
					var txt = $(this).text();
					$(".current-news-menu span").html(txt);


			   });
				$(".current-news-mega-menu a.tab2").click(function () {
					$(".current-news-mega-menu").hide();
				   	$("#section-linemove-2").show();
					$("#section-linemove-1").hide();
					$("#section-linemove-3").hide();
					$("#section-linemove-4").hide();
					$("#section-linemove-5").hide();
					var txt = $(this).text();
					$(".current-news-today-menu span").html(txt);
			   });
				$(".current-news-mega-menu a.tab3").click(function () {
					$(".current-news-mega-menu").hide();
				   	$("#section-linemove-3").show();
					$("#section-linemove-1").hide();
					$("#section-linemove-2").hide();
					$("#section-linemove-4").hide();
					$("#section-linemove-5").hide();
					var txt = $(this).text();
					$(".current-news-menu span").html(txt);
			   });
				$(".current-news-mega-menu a.tab4").click(function () {
					$(".current-news-mega-menu").hide();
				   	$("#section-linemove-4").show();
					$("#section-linemove-1").hide();
					$("#section-linemove-2").hide();
					$("#section-linemove-3").hide();
					$("#section-linemove-5").hide();
					var txt = $(this).text();
					$(".current-news-menu span").html(txt);
			   });
				$(".current-news-mega-menu a.tab5").click(function () {
					$(".current-news-mega-menu").hide();
				   	$("#section-linemove-5").show();
					$("#section-linemove-1").hide();
					$("#section-linemove-2").hide();
					$("#section-linemove-3").hide();
					$("#section-linemove-4").hide();
					var txt = $(this).text();
					$(".current-news-menu span").html(txt);
			   });
		}

		function initYLSToday() {
			[].slice.call( document.querySelectorAll( '.tabs' ) ).forEach( function( el ) {
                new window.CBPFWTabs( el );
            });
		}

		function initYLSTodayLoadMore() {
			$(".extra-content a").click(function () {
				$(this).text(function(_, oldText) {
					return oldText === 'Show Less' ? 'Load More' : 'Show Less';
				});
			});
		}

		function initNewsPage() {

			$(".news-filter-section .header a[data-collapse-group='news']").click(function() {

				if ($(this).is(".collapsed") ){
					$(this).removeClass('collapsed');
					$(".news-filter-section .header a[data-collapse-group='news']").not(this).each(function(){
						$(this).addClass('collapsed');
					});
				}
				else {
					$(this).addClass('collapsed');
				}
			});
			$("[data-collapse-group='news']").click(function () {
				var $this = $(this);
				$("[data-collapse-group='news']:not([data-target='" + $this.data("target") + "'])").each(function () {
					$($(this).data("target")).removeClass("in").addClass('collapse');
				});
			});
		}
		function initAlumniPage() {
			$('.upcoming-event .header').on('show.bs.collapse', function () {
				var actives = $(this).find('.collapse.in'),
					hasData;
				if (actives && actives.length) {
					hasData = actives.data('collapse');
					if (hasData && hasData.transitioning) {
                        return;
                    }
					actives.collapse('hide');
					if (!hasData) {
                        actives.data('collapse', null);
                    }
				}
			});

			$('.upcoming-event .header a').click(function() {

					if ($(this).is(".collapsed") ){
						$(this).removeClass('collapsed');
						$('.upcoming-event .header a').not(this).each(function(){
							$(this).addClass('collapsed');
						});
					}
					else {
						$(this).addClass('collapsed');
					}
			});
		}

		function initTier2Container() {
			var $trigger = $('.page-into .yls-menu');
			var $menu = $('.yls-mega-menu .collapsed-menu');
			if ($trigger.length > 0) {
				$trigger.on('click', function (e) {
					$(".yls-news-menu").removeClass('clicked');
					$(".yls-news-mega-menu").hide();
					var $this = $(this);
					var target = $this.data('target');
					if($trigger.is('.animating')){
						event.stopPropagation();
					}
					else if ($this.hasClass('active')){
						$this.removeClass('active');
						$(target).slideUp(function() {
							$(target).removeClass('menu-open');
						});
					} else if ($menu.is('.menu-open:visible')) {
						var $menuOpen = $menu.closest('.menu-open');
						$trigger.removeClass('active');
						$this.addClass('animating');
						$menuOpen.slideUp({
							complete: function (){
								$menu.removeClass('menu-open');
								$(target).slideDown(function () {
									$(target).addClass('menu-open');
									$trigger.removeClass('animating');
								});
								$this.addClass('active');
							}
						});
					}
					else {
						$this.addClass('animating');
						$(target).slideDown(function() {
							$(target).addClass('menu-open');
							$trigger.removeClass('animating');
						});
						$this.addClass('active');
					}
					e.preventDefault();
				});
			}






			$(".yls-news-menu").click(function () {
				if($(".yls-news-mega-menu").css('display') === 'none') {
					$(".yls-news-mega-menu").show();
					$(".yls-news-menu").addClass('clicked');
					$(".yls-mega-menu .collapsed-menu").hide();
					$(".yls-mega-menu .collapsed-menu").removeClass("menu-open");
					$(".yls-menu").removeClass("active");

				}
				else {
					$(".yls-news-mega-menu").hide();
					$(".yls-news-menu").removeClass('clicked');
				}
			});

			$(".yls-news-mega-menu a.tab1").click(function () {
				$(".yls-news-mega-menu").hide();
				$("#section-linemove-1").show();
				$("#section-linemove-2").hide();
				$("#section-linemove-3").hide();
				$("#section-linemove-4").hide();
				$("#section-linemove-5").hide();
				var txt = $(this).text();
				$(".yls-news-menu span").html(txt);
				$(".yls-news-menu").removeClass('clicked');


			});
			$(".yls-news-mega-menu a.tab2").click(function () {
				$(".yls-news-mega-menu").hide();
				$("#section-linemove-2").show();
				$("#section-linemove-1").hide();
				$("#section-linemove-3").hide();
				$("#section-linemove-4").hide();
				$("#section-linemove-5").hide();
				var txt = $(this).text();
				$(".yls-news-menu span").html(txt);
				$(".yls-news-menu").removeClass('clicked');
			});
			$(".yls-news-mega-menu a.tab3").click(function () {
				$(".yls-news-mega-menu").hide();
				$("#section-linemove-3").show();
				$("#section-linemove-1").hide();
				$("#section-linemove-2").hide();
				$("#section-linemove-4").hide();
				$("#section-linemove-5").hide();
				var txt = $(this).text();
				$(".yls-news-menu span").html(txt);
				$(".yls-news-menu").removeClass('clicked');
			});
			$(".yls-news-mega-menu a.tab4").click(function () {
				$(".yls-news-mega-menu").hide();
				$("#section-linemove-4").show();
				$("#section-linemove-1").hide();
				$("#section-linemove-2").hide();
				$("#section-linemove-3").hide();
				$("#section-linemove-5").hide();
				var txt = $(this).text();
				$(".yls-news-menu span").html(txt);
				$(".yls-news-menu").removeClass('clicked');
			});
			$(".yls-news-mega-menu a.tab5").click(function () {
				$(".yls-news-mega-menu").hide();
				$("#section-linemove-5").show();
				$("#section-linemove-1").hide();
				$("#section-linemove-2").hide();
				$("#section-linemove-3").hide();
				$("#section-linemove-4").hide();
				var txt = $(this).text();
				$(".yls-news-menu span").html(txt);
				$(".yls-news-menu").removeClass('clicked');
			});



		}
		function initTabAccordion() {
            // this is referencing a plugin that does not support AMD.
            // the plugin is assigned to the global window.jQuery when it loads, which is the Drupal version, not the AMD version.
            // therefore, the $ variable here (which refers to the AMD version) does not have the plugin.
            // we need to access the Drupal version (window.jQuery) to use the plugin.
            window.jQuery('.nav-tabs').tabCollapse();
			// Javascript to enable link to tab
			var url = document.location.toString();
			if (url.match('#')) {
                // see above - global jQuery usage.
				window.jQuery('.nav-tabs a[href="#'+url.split('#')[1]+'"]').tab('show') ;
			}

			// Change hash for page-reload
			$('a[data-toggle="tab"]').on('show.bs.tab', function (e) {
				window.location.hash = e.target.hash;
			});
		}
		function initImageHover() {
            // this one is actually referencing a jQuery plugin that supports AMD.
            // however, the 'packaged' version we are using does not (it packages its dependencies).
            // if we use the non-packaged version, we need to obtain the other dependencies.
            // however, we aren't using a dependency management tool, so it is far easier
            // to just use the packaged version.
			window.jQuery( document ).imagesLoaded( function() {

				// select all images that are links
				var $imageLinks = $( '.three-box-callouts a img, .career-section a img, .tier-info-section a img' );//.not( "#thumbs a img, .logo a img, #modalContent img, .subside-header-bar-content a img" );

				// loop through each image that is a link
				$imageLinks.each( function(){
					if(!isMobile){
					// wrap the image link in a div
					$( this ).parent( 'a' ).wrap( '<div class="img-link-wrapper" style="text-align: center;"></div>' );

					// setup initial css
					$( this ).css({ '-webkit-transition' : '0.4s ease',
						'-moz-transition' : '0.4s ease',
						'-o-transition' : '0.4s ease',
						'transition' : '0.4s ease'
					});


						// set the height of the wrapper div to the height of the image
						var imgHeight = $( this ).height();
						var imgWidth = $( this ).width();
						$( this ).parents( 'div.img-link-wrapper' )
							.css({ 'height' : imgHeight,
								'width' : imgWidth,
								'overflow' : 'hidden'
							});

					}
				});

				// add/remove the class on hover
				$imageLinks.hover( function() {
					$( this ).addClass( 'img-link-hovered' );
				}, function() {
					$( this ).removeClass( 'img-link-hovered' );
				});

			});
		}

		function initGallery() {
            // this is referencing a plugin that does not support AMD.
            // the plugin is assigned to the global window.jQuery when it loads, which is the Drupal version, not the AMD version.
            // therefore, the $ variable here (which refers to the AMD version) does not have the plugin.
            // we need to access the Drupal version (window.jQuery) to use the plugin.
			window.jQuery('#carousel').carouFredSel({
				responsive: true,
				circular: false,
				auto: false,
				items: {
					visible: 1,
					width: 200,
					height: '56%'
				},
				scroll: {
					fx: 'directscroll'
				}
			});

            // same as above - use global jQuery (Drupal's)
			window.jQuery('#thumbs').carouFredSel({
				responsive: true,
				circular: false,
				infinite: false,
				auto: false,
				prev: '#prev',
				next: '#next',
				items: {
					visible: {
						min: 2,
						max: 6
					},
					width: 150,
					height: '66%'
				}
			});

			window.jQuery('#thumbs a').click(function() {
				window.jQuery('#carousel').trigger('slideTo', '#' + this.href.split('#').pop() );
				window.jQuery('#thumbs a').removeClass('selected');
				window.jQuery(this).addClass('selected');
				return false;
			});


		}

		//function initTranscriptBtn() {
		//	$(".transcript-btn").click(function () {
		//		if($(".transcript-content").css('display') === 'none') {
		//			$(".transcript-btn").show();
		//		}
		//		else {
		//			$(".transcript-btn").hide();
		//		}
		//	});
		//}

		function initRemoveHR() {
			$(".tier-menu-section").each(function () {
				if ($(this).find("h2").text().length) {
					$(this).find("hr").show();
				}
			});
			$(".news-block").each(function () {

				if ($.trim( $(this).find(".current-news-date").text()).length === 0 ) {
					$(this).find("hr").hide();
				}
				else {
					$(this).find("hr").show();
				}
			});
		}

		function initAddAnchorLink() {
			$( 'a[href^="#"]').each(function() {
					$(this).addClass("anchor-link");
			});
			$( '#thumbs-wrapper a[href^="#"]').each(function() {
				$(this).removeClass("anchor-link");
			});
			$( '.tabs-style-linemove a[href^="#"]').each(function() {
				$(this).removeClass("anchor-link");
			});
			$( '.yls-accordion a[href^="#"]').each(function() {
				$(this).removeClass("anchor-link");
			});
		}

        function initFacultyForm() {
            $(document).on('change', '.faculty-search-bar input[type=radio]', function(e){
                $(this).closest('form').submit();
            });
            $(document).on('click', '#faculty-submit', function(e){
                $(this).closest('form').submit();
            });
        }

        function initFacultyBio() {
            $('#full-bio').click(function(){
                var tab = $('#bio-tab');
                if (tab.closest('li').hasClass('active')) {
                    return;
                }
                tab.trigger('click');
            });
        }


		function initTranscriptBtn() {

			$(".transcript-btn button").click(function() {
				if ($(this).hasClass("collapsed")){
					$(".transcript-btn button").addClass("open");
				}
				else {
					$(".transcript-btn button").removeClass("open");
				}
			});
		}

        function initFullscreenImages() {

            var attrName = window.innerWidth > 800 ? 'large' : 'small';

            $('.background-image[data-'+attrName+'], .slide-background[data-'+attrName+']').each(function () {
                var $this = $(this);
                var src = $this.data(attrName);
                $this.css('background-image', 'url(' + src + ')');
            });
        }

        function initAccordionAccessibility() {
			$( ".yls-accordion #accordion").find(".panel:first").find("h4 a").attr('tabindex', '0');
        }

        function initTextResizeDetector()
        {
            //id of element to check for and insert control

            TextResizeDetector.TARGET_ELEMENT_ID = 'main';

            //function to call once TextResizeDetector has init'd

            TextResizeDetector.USER_INIT_FUNC = function()  {
                // the function returns the initial size, if we happen to need it.
                TextResizeDetector.addEventListener(onFontResize,null);
            };

            function onFontResize(e,args) {
                if (args[0].iSize >= 20) { // 20 is the default height of a <span> tag within the body of the YLS site.
                    $("body").addClass("font_size_large");
                } else {
                    $("body").removeClass("font_size_large");
                }
            }
        }

        initFullscreenImages();
		//init functions
		initAddAnchorLink();
		initRemoveHR();
		initTranscriptBtn();
		//initSelectBoxIt();
		initPlaceholder();
		initUIAccordion();
		initUITabs();
		initSmoothScroll();
		//initSmoothScrollHack();
		initShadowbox();
		initAreasInterest();
		initWeatherAlert();
		initYLSToday();
		initDesktopSearch();
		initYLSMobileMenu();
		initYLSTodayLoadMore();
		//initFilterMenu();
		initTier2Container();
		initNewsPage();
		initTabAccordion();
		initAlumniPage();
		initImageHover();
		initGallery();
        initFacultyForm();
        initFacultyBio();
		initAccordionAccessibility();

		//initTranscriptBtn();

        initTextResizeDetector();


	}());


});
